<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Raspberry Pi</title>
</head>
<body>
<h2>Raspberry Pi</h2>
<p>
<h3>Configuration réseau</h3>
<p>
/etc/network/interfaces
<div style="color: navy; background-color: aqua;"><pre>
auto lo
iface lo inet loopback

### port ethernet de la carte
### adresse fixe pour réseau local
# iface eth0 inet static
# address 192.168.1.20
# netmask 255.255.255.0

### ou adresse dhcp pour connexion a box internet
auto eth0
allow-hotplug eth0
iface eth0 inet dhcp

### port ethernet USB
iface eth1 inet dhcp

### wifi
allow-hotplug wlan0
iface wlan0 inet dhcp
wpa-ssid "myssid"
wpa-psk "mypass"

allow-hotplug ppp0
iface ppp0 inet dhcp

</pre></div>

Ajouter les DNS Google :

<div style="color: lime; background-color: black;"><pre>
$ sudo sh -c "(echo nameserver 8.8.8.8 ; echo nameserver 8.8.4.4) >> /etc/resolv.conf"
</pre></div>

Pour se connecter par wifi :

<div style="color: lime; background-color: black;"><pre>
$ sudo ip route replace default via 192?168.43.1 dev wlan0
$ sudo ifdown wlan0
$ sudo ifup wlan0
</pre></div>

<p>
<h3>Serveur VNC</h3>
<p>
<div style="color: lime; background-color: black;"><pre>
$ sudo apt-get install tightvncserver
</pre></div>

Démarrage automatique : /etc/init.d/vncboot

<div style="color: navy; background-color: aqua;"><pre>
#!/bin/sh
### BEGIN INIT INFO
# Provides: vncboot
# Required-Start: $remote_fs $syslog
# Required-Stop: $remote_fs $syslog
# Default-Start: 2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: Start VNC server at boot time
# Description: Start VNC server at boot time.
### END INIT INFO

USER=root
HOME=/root
export USER HOME

VNCUSER='pi'
eval cd ~$VNCUSER

case "$1" in

 start)
  echo "Starting VNC Server for $VNCUSER"
  su $VNCUSER -c '/usr/bin/tightvncserver :1'
  ;;

 stop)
  echo "Stopping VNC Server"
  # /usr/bin/tightvncserver -kill :1
  pkill Xtightvnc
  ;;

 *)
  echo "Usage: /etc/init.d/vncboot {start|stop}"
  exit 1
  ;;

esac

exit 0
</pre></div>

<div style="color: lime; background-color: black;"><pre>
$ sudo chmod 755 /etc/init.d/vncboot
$ sudo update-rc.d vncboot defaults
</pre></div>
<br>
<p>
<h3>Ouverture automatique d'une session LXDE au démarrage</h3>
<p>

<div style="color: lime; background-color: black;"><pre>
$ sudo nano /etc/inittab
</pre></div>
Remplacer
<div style="color: navy; background-color: aqua;"><pre>
1:2345:respawn:/sbin/getty --noclear 38400 tty1
</pre></div>
par
<div style="color: navy; background-color: aqua;"><pre>
# 1:2345:respawn:/sbin/getty --noclear 38400 tty1
1:2345:respawn:/bin/login -f pi tty1 </dev/tty1 >/dev/tty1 2>&1
</pre></div>

<div style="color: lime; background-color: black;"><pre>
$ sudo raspi-config
</pre></div>
Sélectionner "Enable Boot to Desktop/Scratch" puis "Desktop Login at user pi at the Graphical Desktop".

<br>
<p>
<h3>Prendre une photo avec la caméra</h3>
<p>
Raspberry Pi camera board :
<div style="color: lime; background-color: black;"><pre>
$ raspistill -o cam.jpg
</pre></div>
Caméra USB
<div style="color: lime; background-color: black;"><pre>
$ fswebcam cam.jpg
</pre></div>
<br>

<p>
<h3>Modem SIM900</h3>
<p>
<a href="http://www.cooking-hacks.com/documentation/tutorials/raspberry-pi-gprs-gsm-quadband-sim900">http://www.cooking-hacks.com/documentation/tutorials/raspberry-pi-gprs-gsm-quadband-sim900</a>
Connexion au modem :
<div style="color: lime; background-color: black;"><pre>
$ minicom -b 115200 -D /dev/ttyAMA0
</pre></div>
/dev/ttyAMA0 correspond à l'UART, le port série du Raspberry Pi, pins GPIO14 (TXD) et GPIO15 (RXD).

<h4>Commandes</h4>
<pre>
Command			Response	Description
------- 		--------        -----------

ATD*********;	 			********* is the number to call.
ATA			OK		Answer an incoming call.
ATH			OK		Cancel voice calls.

AT+CMGF=		OK		Specifies the input and output format of the short messages. 0 for PDU mode and 1 for text mode.
AT+CMGS	 				Sends a message.
AT+CMGR=*	 			Reads a message. * is the number of the message.

AT+SAPBR		OK		Configures GPRS profile.
AT+FTPCID=1		OK		Selects profile 1 for FTP.
AT+FTPSERV=”****” 	OK		Sets FTP server domain name or IP address. **** is the domain name or the IP.
AT+FTPPORT=***		OK		Sets FTP server port. *** is the port.
AT+FTPUN=”***”		OK		Sets user name for FTP server access. *** is the user name.
AT+FTPPW=”***”		OK		Sets password for FTP server access. *** is the password.
AT+FTPPUTNAME="****"	OK		Sets destiny name for the file.*** is the name of the file.
AT+FTPPUTPATH="****"	OK		Sets destiny file path. *** is the path of the file.
AT+FTPPUT		OK		Use to put a file into the FTP server.
AT+FTPGETNAME="****"	OK		Sets origin name for the file.*** is the name of the file.
AT+FTPGETPATH="****"	OK		Sets origin file path. *** is the path of the file.
AT+FTPGET	 			Use to get a file into the FTP server.

AT+CIPMUX=		OK		Selects single connection (0) or multiple connection (1)
AT+CSTT="myAPN"		OK		Sets APN
AT+CIICR	 			Brings up wireless connection
AT+CIFSR	 			Get local IP address
AT+CIPSTART	 			Establishes a connection with a server.
AT+CIPSEND	 			Sends data when the a connection is established.
AT+CIPCLOSE	 			Closes the connection

AT+SAPBR		OK		Configures GPRS profile
AT+HTTPINIT		OK		Initializes HTTP service
AT+HTTPPARA		OK		Configures HTTP parameters
AT+HTTPACTION=0		OK		Sets HTTP Method Action , GET in this chase.
AT+HTTPREAD	 			Reads HTTP data
AT+HTTPTERM		OK		Closes the opened HTTP session.
</pre>

<h4>Exemple de programme : envoi de SMS - Source send_sms.cpp</h4>
<div style="color: navy; background-color: aqua;"><pre>
/*
*  Copyright (C) 2012 Libelium Comunicaciones Distribuidas S.L.
*  http://www.libelium.com
*
*  This program is free software: you can redistribute it and/or modify
*  it under the terms of the GNU General Public License as published by
*  the Free Software Foundation, either version 3 of the License, or
*  (at your option) any later version.
*
*  This program is distributed in the hope that it will be useful,
*  but WITHOUT ANY WARRANTY; without even the implied warranty of
*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*  GNU General Public License for more details.
*
*  You should have received a copy of the GNU General Public License
*  along with this program.  If not, see .
*
*  Version 0.1
*  Author: Alejandro Gállego
*/

//Include ArduPi library
#include "arduPi.h"


void switchModule();

int led = 9;
int onModulePin = 2;        // the pin to switch on the module (without press on button)

int timesToSend = 1;        // Numbers of SMS to send
int count = 0;

char phone_number[]="0637127796";     // ********* is the number to call

void out (const char *s)
{
    printf ("%s", s);
    Serial.print (s);
}

void switchModule(){
    digitalWrite(onModulePin,HIGH);
    delay(2000);
    digitalWrite(onModulePin,LOW);
}

void setup(){

    // Serial.begin(115200);                // UART baud rate
    Serial.begin(19200);
    delay(2000);
    pinMode(led, OUTPUT);
    pinMode(onModulePin, OUTPUT);
    switchModule();                    // switches the module ON

    for (int i=0;i < 5;i++){
        delay(5000);
    } 
    
    // delay(5000);

    out("AT+CMGF=1\r\n");         // sets the SMS mode to text
    delay(100);
}

void loop(){

    while (count < timesToSend){
        delay(1500);
        out("AT+CMGS=\"");     // send the SMS number
        out(phone_number);
        out("\"\r\n");
        while(Serial.read()!='>');      
        out("Hola caracola...");     // the SMS body
        delay(500);
        Serial.write(0x1A);       //sends ++
        Serial.write(0x0D);
        Serial.write(0x0A);
	printf("Sent.\n");
        delay(5000);

        count++;
    }
}

int main (){
	printf ("Setup...\n");
	setup();
	printf ("Loop...\n");
	// while(1){
		loop();
	// }
	return (0);
}
</pre></div>

<div style="color: lime; background-color: black;"><pre>
$ g++ -o send_sms send_sms.cpp arduPi.cpp -lrt
$ sudo ./send_sms
</pre></div>

<h4>Connexion internet PPP</h4>
<!--
Créer le fichier /etc/ppp/options-mobile :
<div style="color: navy; background-color: aqua;"><pre>
ttyAMA0
115200
lock
crtscts
modem
passive
novj
defaultroute
replacedefaultroute
noipdefault
usepeerdns
noauth
hide-password
persist
holdoff 10
maxfail 0
debug
</pre></div>
Créer le répertoire /etc/ppp/peers :
<div style="color: lime; background-color: black;"><pre>
$ mkdir /etc/ppp/peers
$ cd /etc/ppp/peers
</pre></div>
-->

Tutoriel : <a href="http://stackoverflow.com/questions/25301229/raspberry-pi-sim900-default-internet-access">http://stackoverflow.com/questions/25301229/raspberry-pi-sim900-default-internet-access</a>

<p>Some notes before start:</p>

<ol>
<li><p>Make sure the power supply you used for raspberrypi is exact 5V and it can provide at-least 2A current without voltage drop-out.The SIM900 power-source must be 3.3V 2A</p></li>
<li><p>Set the SIM900 baud rate to 115200 via: <code>AT+IPR=115200</code></p></li>
<li>Check the modem serial peripheral via: <code>$ screen /dev/ttyAMA0 115200</code> type <code>AT&lt;enter&gt;</code> it will echo: <code>OK</code>. Hit <code>ctrl+a k y</code> to exit.</li>
</ol>

<p><strong>/etc/ppp/options-mobile</strong></p>

<pre><code>ttyAMA0
115200
lock
crtscts
modem
passive
novj
defaultroute
replacedefaultroute
noipdefault
usepeerdns
noauth
hide-password
persist
holdoff 10
maxfail 0
debug
</code></pre>

<p><strong>Create the <code>/etc/ppp/peers</code> directory:</strong></p>

<pre><code>$ mkdir /etc/ppp/peers
$ cd /etc/ppp/peers
</code></pre>

<p><strong>/etc/ppp/peers/mobile-auth</strong></p>

<pre><code>file /etc/ppp/options-mobile
user "your_usr"
password "your_pass"
connect "/usr/sbin/chat -v -t15 -f /etc/ppp/chatscripts/mobile-modem.chat"
</code></pre>

<p><strong>/etc/ppp/peers/mobile-noauth</strong></p>

<pre><code>file /etc/ppp/options-mobile
connect "/usr/sbin/chat -v -t15 -f /etc/ppp/chatscripts/mobile-modem.chat"
</code></pre>

<p><strong>Create the <code>/etc/ppp/chatscripts</code> directory:</strong></p>

<pre><code>$ mkdir /etc/ppp/chatscripts
</code></pre>

<p><strong>/etc/ppp/chatscripts/mobile-modem.chat</strong></p>

<pre><code>ABORT 'BUSY'
ABORT 'NO CARRIER'
ABORT 'VOICE'
ABORT 'NO DIALTONE'
ABORT 'NO DIAL TONE'
ABORT 'NO ANSWER'
ABORT 'DELAYED'
REPORT CONNECT
TIMEOUT 6
'' 'ATQ0'
'OK-AT-OK' 'ATZ'
TIMEOUT 3
'OK' @/etc/ppp/chatscripts/pin
'OK\d-AT-OK' 'ATI'
'OK' 'ATZ'
'OK' 'ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2 +FCLASS=0'
'OK' @/etc/ppp/chatscripts/mode
'OK-AT-OK' @/etc/ppp/chatscripts/apn
'OK' 'ATDT*99***1#'
TIMEOUT 30
CONNECT ''
</code></pre>

<p><strong>/etc/ppp/chatscripts/my-operator-apn</strong></p>

<pre><code>AT+CGDCONT=1,"IP","&lt;apn-name&gt;"
</code></pre>

<p><strong>/etc/ppp/chatscripts/pin.CODE</strong></p>

<pre><code>AT+CPIN=1234
</code></pre>

<p><strong>/etc/ppp/chatscripts/pin.NONE</strong></p>

<pre><code>AT
</code></pre>

<p><strong>/etc/ppp/chatscripts/mode.3G-only</strong></p>

<pre><code>AT\^SYSCFG=14,2,3fffffff,0,1
</code></pre>

<p><strong>/etc/ppp/chatscripts/mode.3G-pref</strong></p>

<pre><code>AT\^SYSCFG=2,2,3fffffff,0,1
</code></pre>

<p><strong>/etc/ppp/chatscripts/mode.GPRS-only</strong></p>

<pre><code>AT\^SYSCFG=13,1,3fffffff,0,0
</code></pre>

<p><strong>/etc/ppp/chatscripts/mode.GPRS-pref</strong></p>

<pre><code>AT\^SYSCFG=2,1,3fffffff,0,0
</code></pre>

<blockquote>
  <ul>
  <li>The SYSCFG line in the mode.* files is device-dependent, and likely Huawei-specific, So You may use the <code>mode.NONE</code> file if your modem is
  SIM900.
  *</li>
  </ul>
</blockquote>

<p><strong>/etc/ppp/chatscripts/mode.NONE</strong></p>

<pre><code>AT
</code></pre>

<p><strong>Make some symbolic links:</strong></p>

<pre><code>$ ln -s /etc/ppp/chatscripts/my-operator-apn /etc/ppp/chatscripts/apn
$ ln -s /etc/ppp/chatscripts/mode.NONE /etc/ppp/chatscripts/mode
$ ln -s /etc/ppp/chatscripts/pin.NONE /etc/ppp/chatscripts/pin
</code></pre>

<p><strong>If you have to enter credentials use <code>mobile-auth</code></strong></p>

<pre><code>$ mv provider provider.example
$ ln -s /etc/ppp/peers/mobile-noauth /etc/ppp/peers/provider
</code></pre>

<p><strong>Check syslog in another console:</strong></p>

<pre><code>$ tail -f /var/log/syslog | grep -Ei 'pppd|chat'
</code></pre>

<p><strong>Finally issue the <code>pon</code> command to see the result:</strong></p>

<pre><code>$ pon
</code></pre>
 
<p>The base instruction : <a href="https://wiki.archlinux.org/index.php/3G_and_GPRS_modems_with_pppd" rel="nofollow">https://wiki.archlinux.org/index.php/3G_and_GPRS_modems_with_pppd</a></p>

<p>
Attention ! Les fichiers de configuration contenant des commandes AT ne doivent pas contenir de ligne vide même à la fin.

<p>
<h4>Configuration Bouygues</h4>
<div style="color: lime; background-color: black;"><pre>
$ ln -s /etc/ppp/peers/mobile-noauth /etc/ppp/peers/provider
</pre></div>
/etc/ppp/chatscripts/bouygues-apn :
<div style="color: navy; background-color: aqua;"><pre>
AT+CGDCONT=1,"IP","ebouygtel.com"
</pre></div>
<div style="color: lime; background-color: black;"><pre>
$ ln -s /etc/ppp/chatscripts/bouygues-apn /etc/ppp/chatscripts/apn
</pre></div>

<p>
<h4>Configuration Orange</h4>
/etc/ppp/peers/mobile-auth :
<div style="color: navy; background-color: aqua;"><pre>
file /etc/ppp/options-mobile
user "orange"
password "orange"
connect "/usr/sbin/chat -v -t15 -f /etc/ppp/chatscripts/mobile-modem.chat"
</pre></div>
<div style="color: lime; background-color: black;"><pre>
$ ln -s /etc/ppp/peers/mobile-auth /etc/ppp/peers/provider
</pre></div>
/etc/ppp/chatscripts/orange-apn :
<div style="color: navy; background-color: aqua;"><pre>
AT+CGDCONT=1,"IP","orange"
</pre></div>
<div style="color: lime; background-color: black;"><pre>
$ ln -s /etc/ppp/chatscripts/orange-apn /etc/ppp/chatscripts/apn
</pre></div>

Pour établir la connexion :
<div style="color: lime; background-color: black;"><pre>
$ sudo pon
$ plog
</pre></div>
Pour couper la connexion :
<div style="color: lime; background-color: black;"><pre>
$ sudo poff
</pre></div>

</body>
</html>

